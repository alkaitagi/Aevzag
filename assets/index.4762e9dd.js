import{e as t,O as e,d as s,x as a,y as n,o,h as l,F as r,z as c,j as i,k as u,A as d,n as v,r as f,w as p,t as b,i as m,G as h,M as x}from"./vendor.c8bf7c27.js";import{_ as y}from"./index.cbab1530.js";var k=t({name:"Context",props:{translation:{type:Object,default:()=>({})},blocks:{type:Array,default:()=>[]},reverse:Boolean},setup(t){const a=e("context",{}),n=s((()=>{const e={};for(const{state:s}of t.blocks){const t=null==s?void 0:s.conditions;t&&Object.entries(t).forEach((([t,s])=>Object.entries(s).forEach((([s])=>{e[t]||(e[t]=new Set),e[t].add(s)}))))}return e}));const o=s((()=>Object.entries(a.value).map((([e,s])=>[...s].filter((t=>{var s;return!(null==(s=n.value[e])?void 0:s.has(t))})).map((s=>{var a,n,o;return n=null==(a=t.translation)?void 0:a[e],o=s,(null==n?void 0:n[o])||o})))))),l=s((()=>o.value.some((t=>null==t?void 0:t.length))));return{translated:o,any:l}}});const g=d();a("data-v-4e6289ab");const j=v("div",{class:"icon"},"info",-1);n();const O=g(((t,e,s,a,n,d)=>t.any?(o(),l("div",{key:0,class:["row text-caption wrap context",{reverse:t.reverse}]},[j,(o(!0),l(r,null,c(t.translated,((t,e)=>(o(),l(r,{key:e},[t.length?(o(!0),l(r,{key:0},c(t,(t=>(o(),l("p",{key:t+"--"+e,class:"colored-dot-"+e},i(t),3)))),128)):u("",!0)],64)))),128))],2)):u("",!0)));k.render=O,k.__scopeId="data-v-4e6289ab";var w=t({name:"State",props:{state:{type:Object,default:()=>({})},glossed:{type:Boolean,default:!1}},emits:["text"],setup(t,{emit:a}){const n=e("context",{}),o=s((()=>Object.keys(n.value))),l=s((()=>t.glossed&&t.state&&(t.state.text.ipa||t.state.text.glossed))),r=s((()=>{const e=[];return l.value?(t.state.text.ipa&&e.push("/"+t.state.text.ipa+"/"),t.state.text.glossed&&e.push(t.state.text.glossed)):e.push(t.state.text.plain),e})),c=s((()=>t.state.transition&&!t.state.transition.length||!t.state.conditions?[]:Object.entries(t.state.conditions).filter((([,t])=>Object.values(t).some((t=>t)))).map((([t])=>o.value.indexOf(t))).map((t=>"colored-back-"+t))));return{texts:r,canGloss:l,dashColors:c,emit:a}}});const _=d();a("data-v-6f5a2368");const E={class:"row dashes"};n();const S=_(((t,e,s,a,n,i)=>{const u=y;return o(),l("div",{class:["display row",{glossed:t.canGloss}]},[v(u,{class:"col-0",notes:t.texts,onTexts:e[1]||(e[1]=e=>t.emit("text",e.join("\n")))},null,8,["notes"]),v("div",E,[(o(!0),l(r,null,c(t.dashColors,((t,e)=>(o(),l("hr",{key:e,class:t},null,2)))),128))])],2)}));function B(){return{text:{plain:"new state"}}}function C(t,e){e&&(t.value={},e.forEach((({entity:e})=>t.value[e]=new Set)))}function A(t,e){var s;if(!t)return[1,0];let a=0,n=0;for(const[o,l]of Object.entries(t))for(const[t,r]of Object.entries(l)){const l=null==(s=e[o])?void 0:s.has(t);if(!r&&!l)return[-1,0];l&&(a+=1),n+=1}return[a/(n||1),n]}function G(t,e,s){var a;let n,o=-1,l=0;return(null!=(a=null==t?void 0:t.map((t=>e[t])))?a:e).forEach((t=>{const[e,a]=A(t.conditions,s);(1===o?1===e&&a>l:e>o)&&(n=t,o=e,l=a)})),n}function I(t,e,s){e&&t.value&&Object.entries(e).forEach((([e,a])=>Object.entries(a).forEach((([a,n])=>{const o=t.value[e];n&&o&&(s?o.add(a):o.delete(a))}))))}w.render=S,w.__scopeId="data-v-6f5a2368";var T=t({name:"Block",components:{VState:w},props:{block:{type:Array,default:void 0},glossed:Boolean},emits:["update"],setup(t,{emit:a}){const n=f(),o=f(""),l=s((()=>n.value&&o.value));p([n,o],(([t,e])=>a("update",{state:t,text:e,show:l})),{immediate:!0});const r=s((()=>{var t;return null==(t=n.value)?void 0:t.transition})),c=s((()=>t.block.length<2||r.value&&!r.value.length)),i=e("context",{});function u(t){var e;b(t)!==b(n.value)&&(I(i,null==(e=n.value)?void 0:e.conditions,!1),I(i,null==t?void 0:t.conditions,!0),n.value=t)}const d=s((()=>{const e=t.block.flatMap((({conditions:t})=>t?Object.keys(t):[]));return[...new Set(e)].map((t=>i.value[t]))}));p(d,(()=>u(G(void 0,t.block,i.value))),{immediate:!0,deep:!0});const v=f(!1);return p(n,(()=>{v.value=!1,setTimeout((()=>v.value=!0),50)})),{flash:v,move:function(){if(c.value)return;const e=t.block;let s;if(r.value)s=G(r.value,e,i.value);else{const t=n.value?e.indexOf(b(n.value)):-1;s=e[(t+1)%e.length]}u(s),A(null==s?void 0:s.conditions,i.value)[0]<0&&(n.value=void 0)},state:n,disabled:c,text:o,show:l}}});const M=d()(((t,e,s,a,n,r)=>{const c=m("VState");return t.state?h((o(),l("button",{key:0,ref:"button",class:["small",{disabled:t.disabled,glossed:t.glossed,flash:t.flash}],onClick:e[2]||(e[2]=(...e)=>t.move&&t.move(...e))},[v(c,{glossed:t.glossed,state:t.state,onText:e[1]||(e[1]=e=>t.text=e)},null,8,["glossed","state"])],2)),[[x,t.show]]):u("",!0)}));T.render=M,T.__scopeId="data-v-03a7852a";export{k as _,T as a,w as b,C as c,B as n};
